<!--
 * Polling Place Application
 * Copyright (c) 2013 Shama Hoque, Linda Avendano, Dan Gillette, Ted Selker
 * Licensed under Open Software License v. 3.0 (OSL-3.0)
 * Date: Wed, Dec 4 2013 
-->


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="EN" lang="EN" dir="ltr">
<head profile="http://gmpg.org/xfn/11">
  <title>Polling Place Application</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="styles/layout.css" type="text/css" />
  <link rel="stylesheet" href="styles/diagram_layout.css" type="text/css">
  <link rel="stylesheet" href="styles/jquery.ui.rotatable.css">
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
</head>
<body id="top">
  <div class="wrapper col1">
    <div id="topbar">
      <h1 class="mainTitle">Polling Place Application</h1>
    </div>
  </div>

  <div class="wrapper col2">

    <div id="homepage">
      <div id="head">
        <div class="instructions">
          <h3>Create your poll place layout<br> with simple drag and drop.</h3>
          <br/>

          <img src="images/overview.png"/>

        </div>
        <div class="outline_options">
          Select the basic outline of your voting area:
          <br/>
          <table border="0" style="padding:10px; margin: 0 auto;">
            <tr>
              <td><img src="images/Rec1.PNG" onclick="makeLayoutPage(1)"/></td>
              <td><img src="images/Rec2.PNG" onclick="makeLayoutPage(2)"/></td>
              <td><img src="images/Rec3.PNG" onclick="makeLayoutPage(3)"/></td>
            </tr>
            <tr>
              <td><img src="images/Rec4.PNG" onclick="makeLayoutPage(4)"/></td>
              <td><img src="images/Rec5.PNG" onclick="makeLayoutPage(5)"/></td>
              <td><img src="images/Rec6.PNG" onclick="makeLayoutPage(6)"/></td>
            </tr>
            <tr>
              <td><img src="images/Rec7.PNG" onclick="makeLayoutPage(7)"/></td>
              <td><img src="images/Rec8.PNG" onclick="makeLayoutPage(8)"/></td>
              <td><img src="images/Rec9.PNG" onclick="makeLayoutPage(9)"/></td>
            </tr>
          </table>

          <br class="clear" />
        </div>
      </div>
    </div>

    <div id="layout_edit" style="display:none; height: 700px;">
      <div class="col3">
        Polling Place Application
        <button onclick="location.reload();">Choose a different outline</button>
        <button onclick="saveCopy();">Save</button>
        <button onclick="reset();">Reset</button>
        
        <div id="checklistMenu">
          <span class='checklistButton'>Checklists</span>
      </div>
      <div id="workspaceMenu">
          <span class='workspaceButton'>Workspace</span>
      </div>
      </div>
      <div id="edit_body">
        <div id="edit">
          <div id="zoom-parent">
          <div id="zoom">
          <div id="diagram">
          </div>
          </div>
        </div>
          <div class="buttons">
            <button class="zoom-in">Zoom In</button>
            <button class="zoom-out">Zoom Out</button>
            <input type="range" class="zoom-range">
            <button class="reset">Reset</button>
          </div>
        </div>

        <div id="toolbox">
        </div>
      </div>
    <div id="checklist_view" class="hide">
      <div id='tabNav'>



      </div>
      
        <div id="allToDos"></div>
    </div> 
      

      <div id="checkboxToDoList"></div>
      <div id="tabsToDoList"></div>

      <div id="default-tag-inputbox">
        <div style="overflow:auto;">
            <div class="snapshot">
              
                <div style="text-align:center;">
                  <button id="screenshot-button">Camera</button> <button id="screenshot-stop-button" style="display:none;">Stop</button><br/>
                  <video id="screenshot-stream" class="videostream" autoplay></video>
                  <img id="screenshot" src="" style="display:none;">
                  <canvas id="screenshot-canvas" style="display:none;"></canvas>
                  
                </div>
            </div>
            <div class="notes">Notes:<br/>
                <textarea rows="18" cols="32">
                  
                </textarea>
            </div>
         </div> 
          <div class="flags">
            Flags:
          </div>
      </div>
    </div>


  </div>


<div class="wrapper col5">
  <div id="copyright">
    <p class="fl_left">Copyright &copy; 2013 - All Rights Reserved</p>
  </div>
</div>

<script type="text/javascript" src="js/FileSaver.min.js"></script>
<script type="text/javascript" src="js/diagram.js"></script>
<script type="text/javascript" src="js/jquery/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="js/jquery/jquery-ui.min.js"></script>
<script src="js/jquery/jquery.ui.rotatable.js"></script>
<script src='js/jquery/jquery.simplemodal.1.4.4.min.js' type='text/javascript'></script>
<script src="js/jquery/jquery.panzoom.min.js"></script>

  <script>
        (function() {

          var $p = $('#zoom').panzoom({
            $zoomIn: $(".zoom-in"),
            $zoomOut: $(".zoom-out"),
            $zoomRange: $(".zoom-range"),
            $reset: $(".reset"),
            startTransform: 'scale(1.0)',
            increment: 0.1,
            minScale: 1,
            contain: 'invert'
          });

          $('#zoom-parent').on('click', function(e){
            e.preventDefault();
            $p.panzoom('zoom', {
              focal: e
            });
          });

        })();

        function errorCallback(e) {
          if (e.code == 1) {
            alert('User denied access to their camera');
          } else {
            alert('getUserMedia() not supported in your browser.');
          }
          //e.target.src = 'http://www.html5rocks.com/en/tutorials/video/basics/Chrome_ImF.ogv';
        }



        (function() {
        var video = document.querySelector('#screenshot-stream');
        var button = document.querySelector('#screenshot-button');
        var stopButton = document.querySelector('#screenshot-stop-button');
        var canvas = document.querySelector('#screenshot-canvas');
        var img = document.querySelector('#screenshot');
        var ctx = canvas.getContext('2d');
        var localMediaStream = null;

        function sizeCanvas() {
          // video.onloadedmetadata not firing in Chrome so we have to hack.
          // See crbug.com/110938.
          setTimeout(function() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            img.height = video.videoHeight;
            img.width = video.videoWidth;
          }, 100);
        }

        function snapshot() {
          ctx.drawImage(video, 0, 0);
          img.src = canvas.toDataURL('image/webp');
          video.style.display = "none";
          img.style.display = "block";
          video.pause();
          localMediaStream.stop();
          localMediaStream = null;
          stopButton.style.display= "none";
          button.textContent = 'Camera';

        }

        button.addEventListener('click', function(e) {
          if (localMediaStream) {
            snapshot();
            return;
          }

            img.style.display = "none";
            video.style.display = "block";

          if (navigator.getUserMedia) {
            navigator.getUserMedia('video', function(stream) {
              video.src = stream;
              localMediaStream = stream;
              sizeCanvas();
              button.textContent = 'Take Shot';
              stopButton.style.display= "inline-block";
            }, errorCallback);
          } else if (navigator.webkitGetUserMedia) {
            navigator.webkitGetUserMedia({video: true}, function(stream) {
              video.src = window.URL.createObjectURL(stream);
              localMediaStream = stream;
              sizeCanvas();
              button.textContent = 'Take Shot';
              stopButton.style.display= "inline-block";
            }, errorCallback);
          } else {
            errorCallback({target: video});
          }
        }, false);

        video.addEventListener('click', snapshot, false);

        document.querySelector('#screenshot-stop-button').addEventListener('click', function(e) {
          video.pause();
          localMediaStream.stop(); // Doesn't do anything in Chrome.
        }, false);
        })();

      </script>
</body>
</html>
